import{r as i,a,j as t,F as E,e as F,y as v}from"./app-63e7952b.js";import{D as j,b as B,c as L,d as A}from"./dialog-ce1b28eb.js";import{B as l}from"./button-23f7c2f7.js";import{n as J,o as U,p as V}from"./index-f2134801.js";import{d as h}from"./utils-2190c141.js";import{I as $}from"./input-eee1757d.js";import{L as N}from"./label-d2ec3fec.js";import{S as m}from"./sweetalert2.esm.all-6b8774ac.js";import"./index-c2a46114.js";import"./index-77ca3b3c.js";import"./index-f96983da.js";function Z({booking:n,remaining_payment:c,openPaymentBookingDialog:P,setOpenPaymentBookingDialog:u}){const[r,y]=i.useState("full"),[w,C]=i.useState(""),[d,x]=i.useState(""),[b,p]=i.useState(!1),f=n.amount*n.package.minimum_dp_percent/100,D=n.payments&&n.payments.length>0,M=c===0,S=e=>new Intl.NumberFormat("id-ID").format(e),g=e=>{const s=parseInt(e.replace(/\./g,""),10);return isNaN(s)?0:s},I=async()=>{try{p(!0);const e=r==="down_payment"?g(w):c;if(r==="down_payment"&&e<f){m.fire({icon:"warning",title:"DP Tidak valid",timer:3e3,showCancelButton:!0,focusConfirm:!1,text:`Jumlah uang muka harus minimal ${h(f)}.`}),p(!1);return}const s=await F.post(route("payments.store"),{booking_invoice:n.invoice,amount:e,payment_type:r,method:d});m.fire({icon:"success",title:"Success",text:s.data.message,showCancelButton:!0,timer:3e3}).then(o=>{(o.isConfirmed||o.isDismissed)&&(v.visit(route("bookings.show",n.invoice),{method:"get"}),u(!1))})}catch(e){m.fire({icon:"error",title:"Error",timer:3e3,text:e.response.data.message}).then(()=>{e.response.status===409&&v.visit(route("bookings.show",n.invoice),{method:"get"}),u(!1)})}finally{p(!1)}},_=e=>{const s=e.target.value,o=g(s),T=s===""?"":S(o);C(T)},k=()=>{if(!d){m.fire({icon:"error",title:"Error",timer:3e3,text:"Mohon pilih Metode Pembayaran."});return}I()};return a("div",{children:a(j,{open:P,onOpenChange:u,children:t(B,{className:"p-0 sm:max-w-[500px]",children:[a(L,{className:"p-8",children:a(A,{children:"Pilih Pembayaran"})}),t("div",{className:"px-8 py-5 pt-0",children:[t("div",{className:"grid grid-cols-2 gap-4 mb-5",children:[t(l,{variant:r==="full"?"default":"outline",className:"w-full mt-1",disabled:M,onClick:()=>y("full"),children:[a(J,{className:"mr-2 w-4"})," Full (",h(c),")"]}),t(l,{variant:r==="down_payment"?"default":"outline",className:"w-full mt-1",disabled:D,onClick:()=>y("down_payment"),children:[a(U,{className:"mr-2 w-4"})," Uang Muka"]})]}),r==="down_payment"&&t("div",{className:"my-5",children:[a(N,{children:"Jumlah Uang Muka"}),a($,{type:"text",className:"w-full mt-1",value:w,onChange:_,placeholder:`Minimal ${h(f)}`})]}),a(N,{children:"Metode Pembayaran"}),a("div",{className:"grid grid-cols-2 gap-4 mb-5",children:["online","offline"].map(e=>t(l,{variant:d===e?"default":"outline",className:"w-full mt-1",onClick:()=>x(e),children:[e==="online"?"Online":null,e==="offline"?"Offline":null]},e))}),a(l,{variant:"default",className:"w-full mt-3",onClick:k,children:b?"Memproses...":t(E,{children:[a(V,{className:"mr-2 w-4"})," Proses Pembayaran"]})})]})]})})})}export{Z as default};
